import{d as B,w as C,r as p,M as E,c as g,i as M,$ as _,a0 as y,l as U,a as i,S as V,b as n,e as a,x as m,y as w,f as h,t as I,m as q,q as A,a1 as F,o as r,a2 as D,a3 as N,_ as T}from"./app-ZXXCAQ4d.js";const $={key:0,class:"form-group"},R={class:"form-group"},j={for:"email",class:"form-label"},z={key:0},G={key:1,class:"form-group"},H={for:"password",class:"form-label"},J={key:0},K=["disabled"],O={class:"text-center"},Q={key:0,class:"success-message"},W={key:1,class:"error-message"},X=B({__name:"LoginForm",props:{withoutId:{type:Boolean,default:!1},withoutPassword:{type:Boolean,default:!1}},emits:["error"],setup(b,{emit:k}){const s=b;C(s,()=>d.value=null);const x=k,e=E({friendId:"",email:"",password:""}),d=p(),u=p(!1),f=p(!1),P=g(()=>u.value?"Loadingâ€¦":s.withoutPassword?"Send Magic Link":s.withoutId?"Sign In":"Create Account"),L=g(()=>!e.email||!e.password&&!s.withoutPassword?!0:s.withoutId?!1:!e.friendId||e.friendId.length!==16||!/^\d+$/.test(e.friendId)),v=()=>{window.location.replace(F.value?"/account/wishlist":"/account/proposals")},S=async()=>{u.value=!0;try{if(s.withoutPassword){f.value=await D(e.email,e.friendId)==="ok",f.value&&(e.email="",e.friendId="");return}let o=!1;s.withoutId?(await _(e.email,e.password),o=await y()):o=await N(e),o&&v()}catch(o){o!=="insufficient credentials"&&(d.value=o),x("error",o)}finally{u.value=!1}};return M(async()=>{const o=new URLSearchParams(window.location.search),t=o.get("email"),c=o.get("token");t&&c&&(await _(t,"",c),await y()&&v())}),(o,t)=>{const c=U("router-link");return r(),i("form",{class:"friend-form",onSubmit:V(S,["prevent"])},[!s.withoutId||s.withoutPassword?(r(),i("div",$,[t[3]||(t[3]=a("label",{for:"friendId",class:"form-label"},'Friend ID (16 digits without "-")',-1)),m(a("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>e.friendId=l),required:"",type:"text",id:"friendId",class:"friend-id",placeholder:"0000000000000000",pattern:"\\d{16}",maxlength:"16"},null,512),[[w,e.friendId]])])):n("",!0),a("div",R,[a("label",j,[t[4]||(t[4]=h("Email address ",-1)),!s.withoutId&&!s.withoutPassword?(r(),i("span",z,"(for notifications about exchange proposals)")):n("",!0)]),m(a("input",{type:"email",id:"email",class:"email-input",placeholder:"Enter your email","onUpdate:modelValue":t[1]||(t[1]=l=>e.email=l),required:""},null,512),[[w,e.email]])]),s.withoutPassword?n("",!0):(r(),i("div",G,[a("label",H,[t[5]||(t[5]=h("Password ",-1)),s.withoutId?n("",!0):(r(),i("span",J,"(for retrieving your data later)"))]),m(a("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>e.password=l),required:"",type:"password",id:"password",class:"password-input",placeholder:"Enter your password"},null,512),[[w,e.password]])])),a("button",{type:"submit",class:"submit-button",disabled:L.value||u.value},I(P.value),9,K),a("div",O,[f.value?(r(),i("p",Q," An email will be sent with a link to signin ! ")):n("",!0),d.value?(r(),i("span",W,"Error: "+I(d.value),1)):n("",!0),d.value==="invalid password"?(r(),q(c,{key:2,to:"/forgotten-password?email="+e.email},{default:A(()=>[...t[6]||(t[6]=[h(" Forgotten password? ",-1)])]),_:1},8,["to"])):n("",!0)])],32)}}}),Z=T(X,[["__scopeId","data-v-2cf2194b"]]);export{Z as L};
