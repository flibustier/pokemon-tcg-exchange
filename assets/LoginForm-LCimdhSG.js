import{d as B,w as E,r as m,M,c as w,i as U,$ as y,a0 as I,l as V,a as i,S as q,b as n,e as a,x as v,y as h,f as g,t as b,m as A,q as F,a1 as D,o as r,a2 as N,a3 as T,_ as $}from"./app-Dqaop2uf.js";const R={key:0,class:"form-group"},j={class:"form-group"},z={for:"email",class:"form-label"},G={key:0},H={key:1,class:"form-group"},J={for:"password",class:"form-label"},K={key:0},O=["disabled"],Q={class:"text-center"},W={key:0,class:"success-message"},X={key:1,class:"error-message"},Y=B({__name:"LoginForm",props:{withoutId:{type:Boolean,default:!1},withoutPassword:{type:Boolean,default:!1}},emits:["error"],setup(k,{emit:x}){const s=k;E(s,()=>d.value=null);const P=x,e=M({friendId:"",email:"",password:""}),f=w(()=>e.email.toLowerCase()),d=m(),u=m(!1),p=m(!1),L=w(()=>u.value?"Loadingâ€¦":s.withoutPassword?"Send Magic Link":s.withoutId?"Sign In":"Create Account"),C=w(()=>!e.email||!e.password&&!s.withoutPassword?!0:s.withoutId?!1:!e.friendId||e.friendId.length!==16||!/^\d+$/.test(e.friendId)),_=()=>{window.location.replace(D.value?"/account/wishlist":"/account/proposals")},S=async()=>{u.value=!0;try{if(s.withoutPassword){p.value=await N(f.value,e.friendId)==="ok",p.value&&(e.email="",e.friendId="");return}let o=!1;s.withoutId?(await y(f.value,e.password),o=await I()):o=await T(e),o&&_()}catch(o){o!=="insufficient credentials"&&(d.value=o),P("error",o)}finally{u.value=!1}};return U(async()=>{const o=new URLSearchParams(window.location.search),t=o.get("email"),c=o.get("token");t&&c&&(await y(t,"",c),await I()&&_())}),(o,t)=>{const c=V("router-link");return r(),i("form",{class:"friend-form",onSubmit:q(S,["prevent"])},[!s.withoutId||s.withoutPassword?(r(),i("div",R,[t[3]||(t[3]=a("label",{for:"friendId",class:"form-label"},'Friend ID (16 digits without "-")',-1)),v(a("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>e.friendId=l),required:"",type:"text",id:"friendId",class:"friend-id",placeholder:"0000000000000000",pattern:"\\d{16}",maxlength:"16"},null,512),[[h,e.friendId]])])):n("",!0),a("div",j,[a("label",z,[t[4]||(t[4]=g("Email address ",-1)),!s.withoutId&&!s.withoutPassword?(r(),i("span",G,"(for notifications about exchange proposals)")):n("",!0)]),v(a("input",{type:"email",id:"email",class:"email-input",placeholder:"Enter your email","onUpdate:modelValue":t[1]||(t[1]=l=>e.email=l),required:""},null,512),[[h,e.email,void 0,{trim:!0}]])]),s.withoutPassword?n("",!0):(r(),i("div",H,[a("label",J,[t[5]||(t[5]=g("Password ",-1)),s.withoutId?n("",!0):(r(),i("span",K,"(for retrieving your data later)"))]),v(a("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>e.password=l),required:"",type:"password",id:"password",class:"password-input",placeholder:"Enter your password"},null,512),[[h,e.password]])])),a("button",{type:"submit",class:"submit-button",disabled:C.value||u.value},b(L.value),9,O),a("div",Q,[p.value?(r(),i("p",W," An email will be sent with a link to signin ! ")):n("",!0),d.value?(r(),i("span",X,"Error: "+b(d.value),1)):n("",!0),d.value==="invalid password"?(r(),A(c,{key:2,to:"/forgotten-password?email="+f.value},{default:F(()=>[...t[6]||(t[6]=[g(" Forgotten password? ",-1)])]),_:1},8,["to"])):n("",!0)])],32)}}}),ee=$(Y,[["__scopeId","data-v-c15cb7ce"]]);export{ee as L};
