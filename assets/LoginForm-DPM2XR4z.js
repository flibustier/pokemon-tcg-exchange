import{d as E,v as S,k as m,z as U,aa as I,ab as b,D as V,c as i,w as M,b as a,G as w,H as v,a as n,e as h,t as y,g as D,h as F,Q as q,f as g,ac as A,o as r,ad as N,ae as T,_ as z}from"./app-BSsdP2ft.js";const G={key:0,class:"form-group"},H={class:"form-group"},Q={for:"email",class:"form-label"},R={key:0},$={key:1,class:"form-group"},j={for:"password",class:"form-label"},J={key:0},K=["disabled"],O={class:"text-center"},W={key:0,class:"success-message"},X={key:1,class:"error-message"},Y=E({__name:"LoginForm",props:{withoutId:{type:Boolean,default:!1},withoutPassword:{type:Boolean,default:!1}},emits:["error"],setup(k,{emit:x}){const s=k;S(s,()=>d.value=null);const P=x,e=q({friendId:"",email:"",password:""}),f=g(()=>e.email.toLowerCase()),d=m(),u=m(!1),p=m(!1),L=g(()=>u.value?"Loadingâ€¦":s.withoutPassword?"Send Magic Link":s.withoutId?"Sign In":"Create Account"),C=g(()=>!e.email||!e.password&&!s.withoutPassword?!0:s.withoutId?!1:!e.friendId||e.friendId.length!==16||!/^\d+$/.test(e.friendId)),_=()=>{window.location.replace(A.value?"/account/wishlist":"/account/proposals")},B=async()=>{u.value=!0;try{if(s.withoutPassword){p.value=await N(f.value,e.friendId)==="ok",p.value&&(e.email="",e.friendId="");return}let o=!1;s.withoutId?(await I(f.value,e.password),o=await b()):o=await T(e),o&&_()}catch(o){o!=="insufficient credentials"&&(d.value=o),P("error",o)}finally{u.value=!1}};return U(async()=>{const o=new URLSearchParams(window.location.search),t=o.get("email"),c=o.get("token");t&&c&&(await I(t,"",c),await b()&&_())}),(o,t)=>{const c=V("router-link");return r(),i("form",{class:"friend-form",onSubmit:M(B,["prevent"])},[!s.withoutId||s.withoutPassword?(r(),i("div",G,[t[3]||(t[3]=a("label",{for:"friendId",class:"form-label"},'Friend ID (16 digits without "-")',-1)),w(a("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>e.friendId=l),required:"",type:"text",id:"friendId",class:"friend-id",placeholder:"0000000000000000",pattern:"\\d{16}",maxlength:"16"},null,512),[[v,e.friendId]])])):n("",!0),a("div",H,[a("label",Q,[t[4]||(t[4]=h("Email address ",-1)),!s.withoutId&&!s.withoutPassword?(r(),i("span",R,"(for notifications about exchange proposals)")):n("",!0)]),w(a("input",{type:"email",id:"email",class:"email-input",placeholder:"Enter your email","onUpdate:modelValue":t[1]||(t[1]=l=>e.email=l),required:""},null,512),[[v,e.email,void 0,{trim:!0}]])]),s.withoutPassword?n("",!0):(r(),i("div",$,[a("label",j,[t[5]||(t[5]=h("Password ",-1)),s.withoutId?n("",!0):(r(),i("span",J,"(for retrieving your data later)"))]),w(a("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>e.password=l),required:"",type:"password",id:"password",class:"password-input",placeholder:"Enter your password"},null,512),[[v,e.password]])])),a("button",{type:"submit",class:"submit-button",disabled:C.value||u.value},y(L.value),9,K),a("div",O,[p.value?(r(),i("p",W," An email will be sent with a link to signin ! ")):n("",!0),d.value?(r(),i("span",X,"Error: "+y(d.value),1)):n("",!0),d.value==="invalid password"?(r(),D(c,{key:2,to:"/forgotten-password?email="+f.value},{default:F(()=>[...t[6]||(t[6]=[h(" Forgotten password? ",-1)])]),_:1},8,["to"])):n("",!0)])],32)}}}),ee=z(Y,[["__scopeId","data-v-1b786245"]]);export{ee as L};
