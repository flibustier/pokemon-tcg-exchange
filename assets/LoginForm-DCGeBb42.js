import{d as L,w as S,r as p,L as B,R as C,c as I,l as E,a as i,o as r,S as U,b as n,e as a,x as m,y as w,f as h,t as _,m as V,q as F,$ as q,a0 as A,a1 as M,a2 as D,a3 as N,_ as T}from"./app-DRl2BE6V.js";const R={key:0,class:"form-group"},$={class:"form-group"},j={for:"email",class:"form-label"},z={key:0},G={key:1,class:"form-group"},H={for:"password",class:"form-label"},J={key:0},K=["disabled"],O={class:"text-center"},Q={key:0,class:"success-message"},W={key:1,class:"error-message"},X=L({__name:"LoginForm",props:{withoutId:{type:Boolean,default:!1},withoutPassword:{type:Boolean,default:!1}},emits:["error"],setup(y,{emit:b}){const t=y;S(t,()=>l.value=null);const k=b,e=B({friendId:C(),email:"",password:""}),l=p(),c=p(!1),v=p(),f=p(!1),x=I(()=>c.value?"Loadingâ€¦":t.withoutPassword?"Send Magic Link":t.withoutId?"Sign In":"Create Account"),P=I(()=>!e.email||!e.password&&!t.withoutPassword?!0:t.withoutId?!1:!e.friendId||e.friendId.length!==16||!/^\d+$/.test(e.friendId)),g=async()=>{c.value=!0;try{if(t.withoutPassword){f.value=await q(e.email,e.friendId)==="ok",f.value&&(e.email="",e.friendId="");return}let o=!1;t.withoutId?o=await A(e):o=await M(e),o&&(await D(e.email,e.password,v.value),window.location.replace(N.value?"/account/wishlist":"/account/proposals"))}catch(o){o!=="user not found"&&(l.value=o),k("error",o)}finally{c.value=!1}};{const o=new URLSearchParams(window.location.search),s=o.get("email"),d=o.get("token");s&&d&&(e.email=s,e.password=d,v.value=d,g())}return(o,s)=>{const d=E("router-link");return r(),i("form",{class:"friend-form",onSubmit:U(g,["prevent"])},[!t.withoutId||t.withoutPassword?(r(),i("div",R,[s[3]||(s[3]=a("label",{for:"friendId",class:"form-label"},'Friend ID (16 digits without "-")',-1)),m(a("input",{"onUpdate:modelValue":s[0]||(s[0]=u=>e.friendId=u),required:"",type:"text",id:"friendId",class:"friend-id",placeholder:"0000000000000000",pattern:"\\d{16}",maxlength:"16"},null,512),[[w,e.friendId]])])):n("",!0),a("div",$,[a("label",j,[s[4]||(s[4]=h("Email address ",-1)),!t.withoutId&&!t.withoutPassword?(r(),i("span",z,"(for notifications about exchange proposals)")):n("",!0)]),m(a("input",{type:"email",id:"email",class:"email-input",placeholder:"Enter your email","onUpdate:modelValue":s[1]||(s[1]=u=>e.email=u),required:""},null,512),[[w,e.email]])]),t.withoutPassword?n("",!0):(r(),i("div",G,[a("label",H,[s[5]||(s[5]=h("Password ",-1)),t.withoutId?n("",!0):(r(),i("span",J,"(for retrieving your data later)"))]),m(a("input",{"onUpdate:modelValue":s[2]||(s[2]=u=>e.password=u),required:"",type:"password",id:"password",class:"password-input",placeholder:"Enter your password"},null,512),[[w,e.password]])])),a("button",{type:"submit",class:"submit-button",disabled:P.value||c.value},_(x.value),9,K),a("div",O,[f.value?(r(),i("p",Q," An email will be sent with a link to signin ! ")):n("",!0),l.value?(r(),i("span",W,"Error: "+_(l.value),1)):n("",!0),l.value==="invalid password"?(r(),V(d,{key:2,to:"/forgotten-password?email="+e.email},{default:F(()=>[...s[6]||(s[6]=[h(" Forgotten password? ",-1)])]),_:1},8,["to"])):n("",!0)])],32)}}}),Z=T(X,[["__scopeId","data-v-ac6de3ad"]]);export{Z as L};
